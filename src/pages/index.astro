---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Confessr - a place to share">
	<main>
		<h1 class="text-gradient">Hello.</h1>

		<p>
			This is a simple early experiment. Click the button below and your phone
			audio recorder should open up (if you're on mobile, otherwise send a
			pre-recorded sound file from your desktop).
		</p>

		<p>
			Record whatever you want, a confession, a secret, a story, whatever you
			want to get off your chest (keep it anonymous). It will then be uploaded
			to the server and may appear on this page in the future.
		</p>

		<input
			type="file"
			accept="audio/*"
			capture
			id="recorder"
			style="display:none"
		/>

		<button
			class="send-audio-button"
			style=""
			onclick="
			document.getElementById('recorder').click()
			"
			>Send your audio...</button
		>

		<p>
			<em
				>Just an experiment for now from <a href="https://bne.social/@phocks"
					>@phocks@bne.social</a
				>
			</em>
		</p>
		<!-- <input type="file" id="getFile" style="display:none" /> -->
		<!-- <audio id="player" controls></audio> -->
		<script>
			const recorder = document.getElementById("recorder");
			// const player = document.getElementById("player");

			recorder.addEventListener("change", function (e) {
				const file = e.target.files[0];
				const url = URL.createObjectURL(file);
				// Do something with the audio file.
				// player.src = url;

				console.log(file);

				const formData = new FormData();

				formData.append("file", file);

				fetch("https://confessions.phocks.org/upload", {
					//  fetch("http://localhost:5000/upload", {
					method: "POST",
					body: formData,
					headers: {
						// "Content-Type": "multipart/form-data",
					},
				})
					.then((res) => console.log(res))
					.catch((err) => ("Error occured", err));
			});
		</script>
	</main>
</Layout>

<style>
	main {
		margin: auto;
		padding: 1.5rem;
		max-width: 60ch;
	}

	h1 {
		font-size: 2.5rem;
		font-weight: 800;
		margin: 0;
	}

	.text-gradient {
		background-image: var(--accent-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-size: 400%;
		background-position: 0%;
	}

	.send-audio-button {
		margin-top: 2rem;
		margin-bottom: 2rem;
		background-color: var(--sunburst-yellow);
		border: 2px solid var(--orange-glow);
		border-radius: 4px;
		color: var(--not-as-dark-text);
		cursor: pointer;
		font-size: 1.1rem;
		padding: 0.5rem 1rem;
		transition: all 0.2s ease;
		display: block;
	}
</style>
